<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Le Jeu du 24 Game</title>
	<link rel="stylesheet" href="style.css">
	
</head>
<body>
	<h1>Le jeu 24</h1>
	<div id="numbers">
		<div id="row1">
			<div id="number0" class="number yellow-number" draggable="true" ondragstart="drag(event)">0</div>
			<div id="number1" class="number yellow-number" draggable="true" ondragstart="drag(event)">1</div>
			<div id="number2" class="number yellow-number" draggable="true" ondragstart="drag(event)">2</div>
			<div id="number3" class="number yellow-number" draggable="true" ondragstart="drag(event)">3</div>
			<div id="number4" class="number yellow-number" draggable="true" ondragstart="drag(event)">4</div>
			<div id="number5" class="number yellow-number" draggable="true" ondragstart="drag(event)">5</div>
			
		<!-- </div>
		<div id="row2">		 --> 
			<!-- <div id="number20" class="number yellow-number" draggable="true" ondragstart="drag(event)">20</div>  -->
			<div id="number6" class="number yellow-number" draggable="true" ondragstart="drag(event)">6</div> 
			<div id="number7" class="number yellow-number" draggable="true" ondragstart="drag(event)">7</div>
			<div id="number8" class="number yellow-number" draggable="true" ondragstart="drag(event)">8</div>
			<div id="number9" class="number yellow-number" draggable="true" ondragstart="drag(event)">9</div>
			<div id="number10" class="number yellow-number" draggable="true" ondragstart="drag(event)">10</div>
			<!-- <div id="number12" class="number yellow-number" draggable="true" ondragstart="drag(event)">12</div> -->
			
		</div>
	</div>
	<h2>
		<form>
			<input type="radio" name="operation" value="Addition" checked> + Addition
			<input type="radio" name="operation" value="Soustraction"> - Soustraction
			<input type="radio" name="operation" value="Multiplication"> x Multiplication
			<input type="radio" name="operation" value="Division"> % Division 
		</form>	
	</h2>
	
	<div id="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" ></div>
	<button id="aideBtn"  onclick="check24('somme')" class="gradient-button">Aide🧸🧸🧸🧸</button>
	<button id="checkRespBtn" onclick="check24('reponse')" class="gradient-button">Trouvez 24</button>
	<button id="scoreBtn" class="gradient2-button">0/0</button>
	<button id="RejouerBtn" onclick="ReloadPage()" class="gradient2-button">🎰</button>
	<script>
		
		var randomNumber=24;
		let totalAnswers = 0;
		let goodAnswers = 0;
		let badAnswers = 0;
		let aideRestant=4
		var originalElement01 = document.getElementById('number' + 1);

		const wordToNumber = {
			zéro: 0,
			un: 1,
			une: 1,
			deux: 2,
			trois: 3,
			quatre: 4,
			cinq: 5,
			six: 6,
			sept: 7,
			huit: 8,
			neuf: 9,
			dix: 10,
			onze: 11,
			douze: 12,
			treize: 13,
			quatorze: 14,
			quinze: 15,
			seize: 16,
			vingt: 20,
			trente: 30,
			quarante: 40,
			cinquante: 50,
			soixante: 60,
			quatrevingt: 80,
			cent: 100
			};


		// Crée une instance de l'objet SpeechRecognition
			const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();


			// Configure la langue (par exemple, le français)
			recognition.lang = 'fr-FR';

			// Écoute les événements de reconnaissance vocale
			recognition.onresult = (event) => {
			const result = event.results[0][0].transcript;
			const parsedNumber = wordToNumber[result.toLowerCase()]||result;
			//const parsedNumber = parseFloat(result);

			tempAlert('🎤 Vous avez dit: <br> '+result + '<br> '+ parsedNumber,2000);

			if (!isNaN(parsedNumber)) {
				console.log(`Nombre reconnu : ${parsedNumber}`);
				changerRandomN1mber01(parsedNumber);
				
			} else {
				console.log("Ce n'est pas un nombre valide.");
			}
			};

			// Crée un bouton pour démarrer la reconnaissance vocale
			const startButton = document.createElement('button');
			startButton.textContent = '🎤';
			startButton.className = 'gradient2-button';
			startButton.addEventListener('click', () => {
			recognition.start();
			});
			// Ajoute le bouton au corps du document
			document.body.appendChild(startButton);
		// Crée une instance de l'objet SpeechRecognition
		
		
		document.addEventListener('DOMContentLoaded', function() {

			//recognition.start();
			
			var numbers = document.querySelectorAll('.number');
			var dropzone = document.getElementById('dropzone');
			var radioBtns = document.querySelectorAll("input[type='radio']");
			
			
			numbers.forEach(function(number) {
				number.addEventListener('click', function() {
					var clonedNumber = number.cloneNode(true);
					dropzone.appendChild(clonedNumber);
					//AjoutSigne(number);
				});
			});
			
			radioBtns.forEach(function(radioBtn) {
				radioBtn.addEventListener('click', function() {
					// Get all elements with the specified values
					const elements = document.querySelectorAll('.number');
					// Loop through the elements and change the value to "Lola" if it matches the specified values
					elements.forEach(element => {
						if (["+", "-", "X", "/"].includes(element.innerHTML.trim())) {
							if (radioBtn.value === "Addition") {
								element.textContent = "+";
							} else if (radioBtn.value === "Soustraction") {
								element.textContent = "-";
							} else if (radioBtn.value === "Multiplication") {
								element.textContent = "X";
							} else if (radioBtn.value === "Division") {
								element.textContent = "/";
							}
							removeAllFromDropzone();
						}
						
					});
					
				});
			});
			
			// Add this code to remove the clicked number from the dropzone
			dropzone.addEventListener('click', function(event) {
				var clickedNumber = event.target.closest('.number');
				if (clickedNumber) {
					dropzone.removeChild(clickedNumber);
				}
			});
			
			addRandomNumberToDropzone();
		});

		document.addEventListener('keydown', function(event) {
			if (event.key === ' ' || event.key === 'Enter') {
				// Ajoutez ici l'action que vous souhaitez exécuter
				check24('reponse');
			}
		});
		
		function removeFromDropzone(event) {
			event.preventDefault();
			var clonedNumber = event.target.cloneNode(true);
			clonedNumber.style.display = 'none';
			event.target.removeChild(clonedNumber);
		}
		
		function removeAllFromDropzone() {
			var dropzone = document.getElementById('dropzone');
			while (dropzone.hasChildNodes()) {
				dropzone.removeChild(dropzone.lastChild);
			}
			addRandomNumberToDropzone();
			//recognition.start();
			
		}
		
		function addRandomNumberToDropzone() {
			
			
			var btncheckResp = document.getElementById("checkRespBtn");
			//randomNumber02 = Math.floor(Math.random() * 3) + 6; // entre 0-2 +6 => entre 6 et 8
			randomNumber02 = Math.floor(Math.random() * 10) + 1; // entre 0-9 +1
			randomNumber01 = Math.floor(Math.random() * 10) + 1; // entre 0-9 +1
			//randomNumber01 = 2;
			//randomNumber01 =20;

			AjoutSigne();
			
			
			
			//randomNumber=24;
			btncheckResp.textContent = 'Trouvez: ' + randomNumber;
			
		}

		function changerRandomN1mber01(randomNumber01) { 
			//Ajouter un number dans la dropzone
			//var originalElement = document.getElementById('number' + randomNumber01);
			var clonedNumber = originalElement01.cloneNode(true);
			clonedNumber.textContent = randomNumber01;
			var dropzone = document.getElementById('dropzone');
			dropzone.appendChild(clonedNumber);
			
			
		}

		
		// JavaScript code here
		function allowDrop(event) {
			event.preventDefault();
		}
		
		function drag(event) {
			event.dataTransfer.setData("text", event.target.id);
		}
		
		function drop(event) {
			event.preventDefault();
			var data = event.dataTransfer.getData("text");
			var clone = document.getElementById(data).cloneNode(true);
			event.target.appendChild(clone);
			//AjoutSigne(document.getElementById(data));
		}
		
		function check24(somme='reponse') {

			//document.getElementById("checkRespBtn").disabled = true;
			document.getElementById("checkRespBtn").hidden = true;
			document.getElementById("RejouerBtn").hidden = true;

			// Your logic to check if the combination of numbers equals 24
			var numbers = dropzone.querySelectorAll('.yellow-number');
			var resultat = 1;
			let selectOperation = document.querySelector('input[name="operation"]:checked').value;
			if (selectOperation === "Addition" || selectOperation === "Soustraction") {
				var resultat = 0;
			}
			
			
			
			for (var i = 0; i < numbers.length; i++) {
				var number = parseInt(numbers[i].textContent)
				var aideBtnID = document.getElementById('aideBtn');
				if (isNaN(number)) {
					continue; // skip the iteration if the number is NaN
				}
				//resultat *= number;

				if (i >= 2) {
					number = 10**(numbers.length-i-1)*number;
					//alert(number);
					
					}
				
				if (selectOperation === "Addition") {
					resultat += number;
				} else if (selectOperation === "Soustraction") {
					if (i === 0) {
						resultat += number;
					} else {resultat -= number;}					
				} else if (selectOperation === "Multiplication") {
					resultat *= number;
				} else if (selectOperation === "Division") {
					if (i === 0) {
						resultat *= number;
					} else {resultat /= number;}
					
				}
			}

			setTimeout(function() {
			//document.getElementById("checkRespBtn").disabled = false;
			document.getElementById("checkRespBtn").hidden = false;
			document.getElementById("RejouerBtn").hidden = false;
			}, 3000);
			
			if (somme=='somme') {					
				if (aideRestant>0) {		
					aideRestant--;								
					tempAlert(selectOperation+ '='+ resultat +'<br><br>Plus que '+ aideRestant +' aides.' ,2000);
					aideBtnID.textContent='Aide'+"🧸".repeat(aideRestant);
				}
				else { tempAlert('Plus d aide.' ,3000); 
				}
			}
			
			else if (resultat === randomNumber) {	
				goodAnswers++;			
				tempAlert('👏 Félicitations ! La réponse est correcte.🎉',2000);
				// set timeout to
				removeAllFromDropzone();
				
				
				
			} else {
				badAnswers++;	
				tempAlert('😢Désolé, la réponse est incorrecte.😰 <br> Vous avez '+ resultat +'❌'+'<br>Je veux '+randomNumber,3000);
			}
			totalAnswers=goodAnswers+badAnswers;
			document.getElementById("scoreBtn").textContent = `${goodAnswers}/${totalAnswers}`;

		}
		
		function ReloadPage() {
			location.reload();
			
		}
		
		function tempAlert(msg,duration)
		{
			var el = document.createElement("div");
			//el.setAttribute("style","position:absolute;top:40%;left:10%;background-color:white;");
			el.setAttribute("style", "position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(1.5); background-color: rgba(255, 255, 255, 0.5);");
			el.innerHTML = msg;
			setTimeout(function(){
				el.parentNode.removeChild(el);
			},duration);
			document.body.appendChild(el);
		}
		
		function AjoutSigne() {	
			let selectOperation = document.querySelector('input[name="operation"]:checked').value;
			var clonedSigne = originalElement01.cloneNode(true);
			if (selectOperation === "Addition") {
				randomNumber = randomNumber02 + randomNumber01;
				clonedSigne.textContent = "+";
			} else if (selectOperation === "Soustraction") { 
				randomNumber01=48;
				let maxNumber = Math.max(randomNumber01, randomNumber02);
				let minNumber = Math.min(randomNumber01, randomNumber02);
				randomNumber = maxNumber  - minNumber;
				randomNumber01 =  maxNumber;
				clonedSigne.textContent = "-";
			} else if (selectOperation === "Multiplication") {
				//randomNumber01=2;
				randomNumber = randomNumber02 *  randomNumber01;
				clonedSigne.textContent = "X";
			} else if (selectOperation === "Division") {
				randomNumber01 =  randomNumber01*randomNumber02;
				randomNumber =  randomNumber01/ randomNumber02;
				clonedSigne.textContent = "/";
			}
			changerRandomN1mber01(randomNumber01);
			dropzone.appendChild(clonedSigne);
		}

		
		
		
	</script>
</body>
</html>
